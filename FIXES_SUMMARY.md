# üéØ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ temporal-graph

## –û–±–∑–æ—Ä –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ—à–µ–Ω–∏–π

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (sqlite-vec)** 
**–ü—Ä–æ–±–ª–µ–º–∞:** `Vector search not available. sqlite-vec extension not loaded.`
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ sqlite-vec
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ `db.loadExtension('vec0')` –Ω–∞ —Ñ—É–Ω–∫—Ü–∏—é `load(db)` –∏–∑ npm-–ø–∞–∫–µ—Ç–∞

```typescript
// –ë—ã–ª–æ:
this.db.loadExtension('vec0');

// –°—Ç–∞–ª–æ:
import { load } from 'sqlite-vec';
load(this.db);
```

#### 2. **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫**
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ `no such column: fts` –≤ SQL –∑–∞–ø—Ä–æ—Å–µ
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—Å–µ–≤–¥–æ–Ω–∏–º –≤ WHERE —É—Å–ª–æ–≤–∏–∏
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å FTS5

```sql
-- –ë—ã–ª–æ:
WHERE fts MATCH ?

-- –°—Ç–∞–ª–æ:
WHERE nodes_fts MATCH ?
```

#### 3. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π (FOREIGN KEY)**
**–ü—Ä–æ–±–ª–µ–º–∞:** `FOREIGN KEY constraint failed` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–≤—è–∑–µ–π
**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–≤—è–∑–∏

```typescript
// –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è:
const fromExists = this.getNode(from);
const toExists = this.getNode(to);

if (!fromExists) {
  throw new Error(`Source document not found: ${from}`);
}

if (!toExists) {
  throw new Error(`Target document not found: ${to}`);
}
```

#### 4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
**–†–µ—à–µ–Ω–∏–µ:** –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –∏ —ç–º–æ–¥–∑–∏

### üÜï –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### 1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –≥—Ä–∞—Ñ–∞**
```bash
graph_check_integrity
```
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –£–∑–ª—ã –±–µ–∑ —Å–≤—è–∑–µ–π (orphaned nodes)
- –°–≤—è–∑–∏ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —É–∑–ª–∞–º–∏
- –û–±—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä–∞—Ñ–∞

#### 2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞**
```bash
graph_rebuild_search_index
```
–ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç FTS –∏–Ω–¥–µ–∫—Å –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–∏—Å–∫–æ–º

### üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã:

```
üß™ Testing temporal-graph fixes...
‚úÖ Vector search initialized successfully
üìÑ Adding documents...
‚úÖ Documents added successfully

üîç Testing document retrieval...
doc_2023_policy: ‚úÖ Found
doc_new_regulation_2024: ‚úÖ Found

üîó Testing relationship creation...
‚úÖ Relationship created: {
  from_node: 'doc_2023_policy',
  to_node: 'doc_new_regulation_2024',
  relation: 'amends',
  weight: 1,
  metadata: { effective_date: '2024-01-01' }
}

üîé Testing full-text search...
Found 1 documents for "policy changes":
  - doc_2023_policy: Policy changes in 2023 regarding new regulations...

üéØ Testing vector search...
Found 1 similar documents:
  - doc_new_regulation_2024 (similarity: 0.814)

üìä Testing graph statistics...
Graph stats: { nodeCount: 2, edgeCount: 1, avgDegree: 1 }

üîß Testing graph integrity...
Integrity check: { orphanedNodes: [], missingDocuments: [], inconsistentEdges: [] }

üë• Testing neighbors...
Neighbors of doc_2023_policy: [
  {
    id: 'doc_new_regulation_2024',
    relation: 'amends',
    direction: 'outgoing'
  }
]

‚ú® All tests completed successfully!
```

### üìã –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **src/storage/database.ts**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ sqlite-vec
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–µ–π
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

2. **src/api/graph-api.ts**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `checkIntegrity()` –∏ `rebuildSearchIndex()`

3. **src/mcp/tools.ts**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

4. **src/mcp/server.ts**
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### üéØ –ò—Ç–æ–≥

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ –æ—Ç–∑—ã–≤–µ, —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:

- ‚úÖ **–í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —á–µ—Ä–µ–∑ npm-–ø–∞–∫–µ—Ç sqlite-vec
- ‚úÖ **–ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** –Ω–∞—Ö–æ–¥–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
- ‚úÖ **–°–≤—è–∑–∏ –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏** —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ **–û—à–∏–±–∫–∏** —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏
- ‚úÖ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** –≤–æ–∑–º–æ–∂–Ω–∞ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç temporal-graph —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!